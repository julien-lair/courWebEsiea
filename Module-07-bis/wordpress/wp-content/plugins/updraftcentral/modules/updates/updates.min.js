function UpdraftCentral_Updates(){var a,_,o=this,h=jQuery,e=".updraftcentral_row_extracontents",m=UpdraftCentral.get_debug_level(),t=50,n=!1,v=(this.backup_choice="default",new UpdraftCentral_Credentials),g=new UpdraftCentral_Collection,u=new UpdraftCentral_Collection,f=new UpdraftCentral_Collection,l=new UpdraftCentral_Tasks_Runner,p=new UpdraftCentral_Collection,c=_=!1,b=new UpdraftCentral_Collection,y=new UpdraftCentral_Collection;function w(e,t,a,s){var r,i,n,d,o=t.data("site_id"),t=g.item(o),l=(0<m&&(console.log("UpdraftCentral: update error (follows)"),console.log(e)),a.find(".update-go").show(),a.find(".update-in-progress").hide(),t.site_description),u=t.site_url,p=(l==u&&(l=""),""),a=(e.hasOwnProperty("messages")&&jQuery(e.messages).each(function(e,t){p+=t+"\n"}),0<m&&("unable_to_connect_to_filesystem"==e.error?console.log("UpdraftCentral: unable_to_connect_to_filesystem: filesystem credentials apparently wrong; will clear"):console.log("UpdraftCentral: update failed: will clear filesystem credentials in case they were wrong")),t.update_processing=!1,t.site_credentials=!1,g.update(o,t),e.hasOwnProperty("error_message")&&""!=e.error_message?r=e.error_message:udclion.updates.update_error_messages.hasOwnProperty(e.error)?r=udclion.updates.update_error_messages[e.error]:(r=udclion.updates.update_error_messages.update_failed,"update_failed"!=e.error&&(r+=" ("+e.error+")")),jQuery("#updraftcentral_notice_container")),c=jQuery('#updraftcentral_notice_container > .updraftcentral_notice[data-site_id="'+o+'"]:first');i=a,n=jQuery.Deferred(),d=setInterval(function(){i.html().trim().length<1&&(clearInterval(d),n.resolve(!0))},1e3),setTimeout(function(){clearInterval(d),n.reject(!1)},1e4),n.promise().then(function(){c=UpdraftCentral.add_dashboard_notice(UpdraftCentral.template_replace("updates-update-error-container",{site_url:u,site_description:l}),"error",!1,{site_id:o})}).always(function(){c.find(".update-errors").append(UpdraftCentral.template_replace("updates-update-error",{error_message:r,error:e.error,messages:p,entity_info:s,entity:e}))})}function d(e,t){_?t.set_custom_status(udclion.updates.backup_currently_running_for+" "+e.site_description):t.set_custom_status(udclion.updates.backup_currently_running),e.hasOwnProperty("autobackup_requested")&&e.autobackup_requested?e.hasOwnProperty("autobackup_complete")&&e.autobackup_complete?0<m&&console.log("UpdraftCentral: automatic pre-upgrade backup was already requested, and is complete"):0<m&&console.log("UpdraftCentral: automatic pre-upgrade backup was already requested, but is not yet complete"):(0<m&&console.log("UpdraftCentral: automatic pre-upgrade backup indicated - will request"),e.autobackup_requested=!0,e.autobackup_complete=!1,g.update(e.id,e),t="",e.updates.plugin.count()&&(t="plugins"),e.updates.theme.count()&&(t=t?t+",themes":"themes"),e.updates.core.count()&&(t=t?t+",wpcore":"wpcore"),extra_data={_listener_title:"<h2>"+e.site_description+" - "+udclion.updates.automatic_backup+"</h2>"},UpdraftCentral.set_current_site_row(e.site_row),UpdraftCentral_Module_UpdraftPlus.backupnow_go(!1,!1,!1,t,extra_data,udclion.updates.automatic_backup))}function k(e,t,a){var s=jQuery.Deferred();return t.additional_options={progress_bar:a.progress,update_info:e,items_count:a.tasks_count()},function t(s){var r=jQuery.Deferred();var e=s.additional_options.progress_bar;var i=s.additional_options.update_info;e.set_custom_status(udclion.updates.processing_please_wait,!0);!s.site_credentials&&s.credentials_required?v.get_credentials(s).then(function(e){s.site_credentials=e.site_credentials,s.save_credentials_in_browser=e.save_credentials_in_browser,t(s).then(function(e){r.resolve(e)}).fail(function(e){_?r.resolve({skip:!0,response:udclion.failed_credentials,site:s.site_description}):r.reject(e)})}).fail(function(e){r.resolve({skip:!0,response:udclion.failed_credentials,site:s.site_description})}):I(s,i).then(function(e){r.resolve(e)}).fail(function(e){var t=UpdraftCentral_Library.md5(s.id+"_"+i.name),a=s.update_queue.item(t);void 0!==a&&a&&a.hasOwnProperty("key")&&(l.remove_task(a.key),b.remove(t),s.update_queue.remove(t)),r.resolve({skip:!0,item:!0,response:i,site:s.site_description})});return r.promise()}(t).then(function(e){s.resolve(e)}).fail(function(e){s.reject(e)}),s.promise()}function C(s,e,t){if("up_to_date"==s)return 1;if(void 0!==t&&t.latest==t.old)return 1;if(void 0!==e&&e){var r=udclion.updates.latest_version,i=(void 0!==r&&r&&r.length&&(r=r.toLowerCase()),udclion.updates.up_to_date);if(void 0!==i&&i&&i.length&&(i=i.toLowerCase()),e.length)if(Array.isArray(e)){if(e.filter(function(e,t,a){return"string"!=typeof e&&(e+=""),e=e.toLowerCase(),"update_failed"==s&&-1!==e.indexOf(r)||-1!==e.indexOf(i)}).length)return 1}else if("string"!=typeof e&&(e+=""),e=e.toLowerCase(),"update_failed"==s&&(-1!==e.indexOf(r)||-1!==e.indexOf(i)))return 1}}function I(l,e){var a=jQuery.Deferred(),u=l.site_row,p={},c=jQuery("#updates_container div.updraftcentral_table > .tbody"),t=90*l.additional_options.items_count;switch(400<t&&(t=400),void 0!==e.mysql_error&&delete e.mysql_error,e.entity){case"plugin":p.plugins=[{plugin:e.plugin,slug:e.slug}];break;case"theme":p.themes=[{theme:e.theme}];break;case"core":p.core=[{core:e.core}],t+=450;break;case"translation":p.translations=[{translation:e.translation}]}return l.site_credentials&&(p.meta={filesystem_credentials:l.site_credentials}),UpdraftCentral.send_site_rpc("updates.do_updates",p,u,function(r,e,t){var i,n,s,d,o;"ok"==e&&r?(s=u,d=jQuery.Deferred(),o={force_refresh:!0},UpdraftCentral.send_site_rpc("updates.get_updates",o,s,function(e,t,a){"ok"==t&&e&&"updates"==UpdraftCentral.get_dashboard_mode()?(o.force_refresh=!1,UpdraftCentral.cache_response(s.data("site_id"),"updates.get_updates",o,e).then(function(e){d.resolve(e)})):d.reject(null)},null),d.promise().always(function(e){var n=!1,d=!1,o=[];jQuery(r.data.plugins).each(function(e,t){var a=t.plugin,s=u.find('.updraft_updates_output .updates-plugin-update[data-plugin-file="'+a+'"]'),a=(s=_?c.find('.row.update-item.updates-plugin-update[data-plugin-file="'+a+'"][data-website_id="'+l.id+'"]'):s).data("plugin-info"),r=s.data("new_version"),i=t.hasOwnProperty("error")?"failure":"success",i=(t.hasOwnProperty("error")&&void 0!==udclion.updates.update_error_messages[t.error]&&void 0===t.message&&(t.message=udclion.updates.update_error_messages[t.error]),o.push({site_id:u.data("site_id"),event_type:"update",event_name:"update.plugin",event_data:JSON.stringify(a),event_status:i,event_result_data:JSON.stringify(t)}),{latest:r,old:t.oldVersion});t.hasOwnProperty("error")&&!C(t.error,t.messages,i)?(0<m&&(console.log("send_remote_updates (updates.do_updates): error_code="+t.error+",latest_version="+r+",old_version="+t.oldVersion),console.log("send_remote_updates (failed update): response object (follows):"),console.log(t)),d=!0,w(t,u,s,a)):(n=!0,0<m&&t.hasOwnProperty("messages")&&console.log(t.messages),UpdraftCentral.refresh_available_updates_display(u.data("site_id")),s.slideUp("slow",function(){s.remove()}))}),jQuery(r.data.themes).each(function(e,t){var a=t.theme,s=u.find('.updraft_updates_output .updates-theme-update[data-theme="'+a+'"]'),a=(s=_?c.find('.row.update-item.updates-theme-update[data-theme="'+a+'"][data-website_id="'+l.id+'"]'):s).data("theme-info"),r=s.data("new_version"),i=t.hasOwnProperty("error")?"failure":"success",i=(t.hasOwnProperty("error")&&void 0!==udclion.updates.update_error_messages[t.error]&&void 0===t.message&&(t.message=udclion.updates.update_error_messages[t.error]),o.push({site_id:u.data("site_id"),event_type:"update",event_name:"update.theme",event_data:JSON.stringify(a),event_status:i,event_result_data:JSON.stringify(t)}),{latest:r,old:t.oldVersion});t.hasOwnProperty("error")&&!C(t.error,t.messages,i)?(0<m&&(console.log("send_remote_updates (updates.do_updates): error_code="+t.error+",latest_version="+r+",old_version="+t.oldVersion),console.log("send_remote_updates (failed update): response object (follows):"),console.log(t)),d=!0,w(t,u,s,a)):(n=!0,0<m&&t.hasOwnProperty("messages")&&console.log(t.messages),UpdraftCentral.refresh_available_updates_display(u.data("site_id")),s.slideUp("slow",function(){s.remove()}))}),jQuery(r.data.core).each(function(e,t){var a=u.find(".updraft_updates_output .updates-core-update"),s=(a=_?c.find('.row.update-item.updates-core-update[data-website_id="'+l.id+'"]'):a).data("core-info"),r=a.data("new_version"),i=t.hasOwnProperty("error")?"failure":"success",i=(s.name=udclion.updates.wordpress,t.hasOwnProperty("error")&&void 0!==udclion.updates.update_error_messages[t.error]&&void 0===t.message&&(t.message=udclion.updates.update_error_messages[t.error]),o.push({site_id:u.data("site_id"),event_type:"update",event_name:"update.core",event_data:JSON.stringify(s),event_status:i,event_result_data:JSON.stringify(t)}),{latest:r,old:t.oldVersion});t.hasOwnProperty("error")&&!C(t.error,t.messages,i)?(0<m&&(console.log("send_remote_updates (updates.do_updates): error_code="+t.error+",latest_version="+r+",old_version="+t.oldVersion),console.log("send_remote_updates (failed update): response object (follows):"),console.log(t)),d=!0,w(t,u,a,s)):(n=!0,0<m&&t.hasOwnProperty("messages")&&console.log(t.messages),UpdraftCentral.refresh_available_updates_display(u.data("site_id")),a.slideUp("slow",function(){a.remove()}))}),jQuery(r.data.translations).each(function(e,t){var a=u.find('.updraft_updates_output .updates-translation-update[data-website_id="'+l.id+'"]'),s=(a=_?c.find('.row.update-item.updates-translation-update[data-website_id="'+l.id+'"]'):a).data("translation-info"),r=t.hasOwnProperty("error")?"failure":"success";t.hasOwnProperty("error")&&void 0!==udclion.updates.update_error_messages[t.error]&&void 0===t.message&&(t.message=udclion.updates.update_error_messages[t.error]),o.push({site_id:u.data("site_id"),event_type:"update",event_name:"update.translation",event_data:JSON.stringify(s),event_status:r,event_result_data:JSON.stringify(t)}),t.hasOwnProperty("error")&&!C(t.error,t.messages)?(0<m&&(console.log("send_remote_updates (updates.do_updates): error_code="+t.error),console.log("send_remote_updates (failed update): response object (follows):"),console.log(t)),d=!0,w(t,u,a,s)):(n=!0,0<m&&t.hasOwnProperty("messages")&&console.log(t.messages),UpdraftCentral.refresh_available_updates_display(u.data("site_id")),a.slideUp("slow",function(){a.remove()}))}),n&&!d&&l.save_credentials_in_browser&&UpdraftCentral.storage_set("filesystem_credentials_"+l.site_hash,l.site_credentials,!0),UpdraftCentral.bulk_log_event(o).always(function(){d?a.reject(r):a.resolve(r)})})):(i=[],n=[],p.hasOwnProperty("plugins")&&jQuery(p.plugins).each(function(e,t){var a=t.plugin,s=u.find('.updraft_updates_output .updates-plugin-update[data-plugin-file="'+a+'"]'),a=(s=_?c.find('.row.update-item.updates-plugin-update[data-plugin-file="'+a+'"][data-website_id="'+l.id+'"]'):s).data("plugin-info");t.error="update_failed",r.hasOwnProperty("data")&&(t.debug=r.data),n.push({site_id:u.data("site_id"),event_type:"update",event_name:"update.plugin",event_data:JSON.stringify(a),event_status:"failure",event_result_data:JSON.stringify(t)}),w(t,u,s,a),i.push({entity_info:a,error:t.error})}),p.hasOwnProperty("themes")&&jQuery(p.themes).each(function(e,t){var a=t.theme,s=u.find('.updraft_updates_output .updates-theme-update[data-theme="'+a+'"]'),a=(s=_?c.find('.row.update-item.updates-theme-update[data-theme="'+a+'"][data-website_id="'+l.id+'"]'):s).data("theme-info");t.error="update_failed",r.hasOwnProperty("data")&&(t.debug=r.data),n.push({site_id:u.data("site_id"),event_type:"update",event_name:"update.theme",event_data:JSON.stringify(a),event_status:"failure",event_result_data:JSON.stringify(t)}),w(t,u,s,a),i.push({entity_info:a,error:t.error})}),p.hasOwnProperty("core")&&jQuery(p.core).each(function(e,t){var a=u.find(".updraft_updates_output .updates-core-update"),s=(a=_?c.find('.row.update-item.updates-core-update[data-website_id="'+l.id+'"]'):a).data("core-info");s.name=udclion.updates.wordpress,t.error="update_failed",r.hasOwnProperty("data")&&(t.debug=r.data),n.push({site_id:u.data("site_id"),event_type:"update",event_name:"update.core",event_data:JSON.stringify(s),event_status:"failure",event_result_data:JSON.stringify(t)}),w(t,u,a,s),i.push({entity_info:s,error:t.error})}),p.hasOwnProperty("translations")&&jQuery(p.translations).each(function(e,t){var a=u.find('.updraft_updates_output .updates-translation-update[data-website_id="'+l.id+'"]'),s=(a=_?c.find('.row.update-item.updates-translation-update[data-website_id="'+l.id+'"]'):a).data("translation-info");t.error="update_failed",r.hasOwnProperty("data")&&(t.debug=r.data),n.push({site_id:u.data("site_id"),event_type:"update",event_name:"update.translation",event_data:JSON.stringify(s),event_status:"failure",event_result_data:JSON.stringify(t)}),w(t,u,a,s),i.push({entity_info:s,error:t.error})}),UpdraftCentral.bulk_log_event(n).always(function(){a.reject(i)}))},null,t),a.promise()}function j(e,t){s(jQuery(".updraftcentral_row_extracontents button#btn-update-all"),e,t)}function U(e,t){s(jQuery(".updraftcentral_row_extracontents button#btn-mass-update"),e,t)}function s(e,t,a){t=t.tasks_count(),a=void 0!==a&&a?(e.addClass("disabled"),udclion.updates.updates_in_progress):(0<t?e.removeClass("disabled"):e.addClass("disabled"),a=1==t?udclion.updates.queued_update:udclion.updates.queued_updates,'<span class="dashicons dashicons-controls-play"></span> '+udclion.updates.process+" "+a+" ("+t+")");e.html(a)}function Q(e,t){var a=u.item(e.id);void 0!==a&&(void 0!==t&&a.progress.abort(t),a.clear_tasks(),u.update(e.id,a),f.clear(),e.update_processing=!1,void 0!==g&&g.update(e.id,e),j(a),jQuery(".updraftcentral_row_extracontents button.update-go").removeClass("disabled").show(),jQuery(".updraftcentral_row_extracontents button.update-in-progress").removeClass("disabled").hide(),setTimeout(function(){a.progress.reset()},2e3))}function O(e,i,t,a){var n,s,d,r,o,l=jQuery.Deferred(),u=a.data("site_id"),p=new UpdraftCentral_Site(a),c=(g.exists(u)&&(p=g.item(u)),""),_={},f={plugins:null,themes:null,core:null,translations:null};return e.data&&(dayjs.extend(dayjs_plugin_relativeTime),r=dayjs().fromNow(),e.data.hasOwnProperty("plugins")&&e.data.plugins.length&&(_={plugins:e.data.plugins,website:p.site_description,website_id:p.id,host_url:p.site_url},_=h.extend({last_fetched:e.hasOwnProperty("last_fetched")?e.last_fetched:r},_),f.plugins=UpdraftCentral.template_replace("updates-plugin-mass-updates",_),c+=f.plugins),e.data.hasOwnProperty("themes")&&e.data.themes.length&&(_={themes:e.data.themes,website:p.site_description,website_id:p.id,host_url:p.site_url},_=h.extend({last_fetched:e.hasOwnProperty("last_fetched")?e.last_fetched:r},_),f.themes=UpdraftCentral.template_replace("updates-theme-mass-updates",_),c+=f.themes),e.data.hasOwnProperty("core")&&e.data.core.length&&(_={core:e.data.core,website:p.site_description,website_id:p.id,host_url:p.site_url},_=h.extend({last_fetched:e.hasOwnProperty("last_fetched")?e.last_fetched:r},_),f.core=UpdraftCentral.template_replace("updates-core-mass-updates",_),c+=f.core),e.data.hasOwnProperty("translations")&&e.data.translations&&(s=udclion.updates.translations+" ("+p.site_description+")",_={translations:e.data.translations.items,as_json:JSON.stringify(e.data.translations.items),website_id:p.id,website:p.site_description,name:s},_=h.extend({last_fetched:e.hasOwnProperty("last_fetched")?e.last_fetched:r},_),f.translations=UpdraftCentral.template_replace("updates-translation-mass-updates",_),c+=f.translations),e.data.hasOwnProperty("meta"))&&void 0!==e.data.meta.automatic_backups&&(p.automatic_backups=e.data.meta.automatic_backups),f.plugins||f.themes||f.core||f.translations?(n=i.find(".updraft_updates_output"),s=jQuery("<option/>",{value:p.site_description}),c=UpdraftCentral_Library.sanitize_html(c),s.html(p.site_description),g.exists(u)||g.add(p.id,p),d=p,r=c,o=jQuery.Deferred(),d.updates.plugin.clear(),d.updates.theme.clear(),d.updates.core.clear(),d.updates.translation.clear(),jQuery("<table/>",{style:"display:none;"}).html(r).find(".row.update-item").each(function(){var e=jQuery(this),t=e.data("entity"),a=e.data("name"),s=e.data(t+"-info");if("translation"===t||("core"===t||s&&s.hasOwnProperty("update"))&&("core"!==t||s&&s.hasOwnProperty("version"))){var r,e=!0;if(s.hasOwnProperty("installed")&&s.installed.hasOwnProperty("is_mysql")&&!s.installed.is_mysql&&(e=!1),s.hasOwnProperty("sufficient")&&(e=!e||s.sufficient.mysql,r=s.sufficient.php,e?r||(mysql_error="<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php,s.version,s.php_version,s.installed.php)):mysql_error=r?"<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_mysql,s.version,s.mysql_version,s.installed.mysql):"<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php_and_mysql,s.version,s.php_version,s.mysql_version,s.installed.php,s.installed.mysql)),void 0===a||!a||!a.length)switch(t){case"plugin":case"theme":a=s.update[t];break;case"core":a=udclion.updates.wordpress;break;case"translation":a=udclion.updates.translations+" ("+d.site_description+")"}if(void 0!==a&&a&&a.length){var i={},n=!1;switch(t){case"plugin":i.plugin=s.update.plugin,i.slug=s.update.slug,i.label=s.name,i.name=a,i.old_version=s.version,i.new_version=s.update.new_version,i.plugin&&i.plugin.length&&i.slug&&i.slug.length||(n=!0);break;case"theme":i.theme=s.update.theme,i.label=s.name,i.name=a,i.old_version=s.version,i.new_version=s.update.new_version,i.theme&&i.theme.length||(n=!0);break;case"core":"undefined"!=typeof mysql_error&&(i.mysql_error=mysql_error),i.core=s.version,i.label=a,i.name=a,i.old_version=s.installed.version,i.new_version=s.version,i.core&&i.core.length||(n=!0);break;case"translation":i.translation=1,i.label=udclion.updates.translations,i.name=a}!n&&i&&i.hasOwnProperty("name")&&i.name?(e=UpdraftCentral_Library.md5(d.id+"_"+i.name),d.updates[i.entity=t].add(e,i)):0<m&&(console.log("UpdraftCentral: preload_site_updates_credentials(): update ("+t+") without expected info (details follow)"),console.log(i))}}}),v.load_credentials(d).then(function(e){var t,a=e.request_filesystem_credentials,s=!1;for(t in a)UpdraftCentral_Library.parseBool(a[t])&&(s=!0);d.credentials_required=s,g.update(d.id,d),0<m&&console.log("UpdraftCentral: remote site credentials has been loaded"),o.resolve({site:d,response:e})}).fail(function(e){o.reject(e)}),o.promise().then(function(e){i.find("div.updraftcentral_table").is(":visible")||i.find("div.updraftcentral_table").show(),i.find("div.updraftcentral_table > .tbody").append(c),i.find('div.updraftcentral_table > .tbody input[name="uc_updates_check_item"]').attr("disabled",!0);var t=jQuery("div.updates_table_container.mass_updates"),a=t.find('.row.update-item[data-entity="plugin"]:visible').length,s=t.find('.row.update-item[data-entity="theme"]:visible').length,r=t.find('.row.update-item[data-entity="core"]:visible').length;translation_count=t.find('.row.update-item[data-entity="translation"]:visible').length,t.find(".filter-elements span.filter_plugin_count").html(a),t.find(".filter-elements span.filter_theme_count").html(s),t.find(".filter-elements span.filter_core_count").html(r),t.find(".filter-elements span.filter_translation_count").html(translation_count),l.resolve({output:c,output_container:n,response:e,skip:!1})}).fail(function(e){l.resolve({skip:!0,response:e,site:a.data("site_description")})})):l.resolve({skip:!0,response:udclion.updates.no_updates,site:a.data("site_description")}),l.promise()}function V(s,r,e){var i=jQuery.Deferred(),e=e.progress,t={force_refresh:!1},e=(n&&(t.force_refresh=!0),e.set_custom_status(udclion.updates.loading_please_wait,!0),UpdraftCentral.get_cached_response(s.data("site_id"),"updates.get_updates"));return null!==e&&UpdraftCentral.is_data_good_to_use(e.created)&&!n?(dayjs.extend(dayjs_plugin_relativeTime),O(h.extend({last_fetched:dayjs.unix(e.created).fromNow()},e.reply),r,0,s).then(function(e){i.resolve(e)})):UpdraftCentral.send_site_rpc("updates.get_updates",t,s,function(t,e,a){if("ok"!=e||!t||"updates"!=UpdraftCentral.get_dashboard_mode())return i.resolve({skip:!0,response:t&&t.hasOwnProperty("error")?t.error:t,site:s.data("site_description")}),!0;UpdraftCentral.cache_response(s.data("site_id"),"updates.get_updates",{force_refresh:!1},t).then(function(e){O(t,r,0,s).then(function(e){UpdraftCentral.refresh_available_updates_display(s.data("site_id")),i.resolve(e)})})},null,90),i.promise()}function x(){var e=h("input#filter_patch_release"),t=h("input#filter_site_patch_release"),a=!1,s=(a=e.is(":visible")?!0:a)?"mass_updates":"per-site",s=h(".updates_table_container."+s+" .updraftcentral_table"),r=s.find(".uc_no_patch_releases"),i=s.find(".uc_no_incompatible_items"),n=s.find("div.no_compatible_items_message");r.length&&r.hide(),n.length&&n.hide(),(e.length&&e.is(":visible")&&e.is(":checked")||t.length&&t.is(":visible")&&t.is(":checked"))&&(n=!!a&&s.find("div#no_matching_items").length,i.length&&i.is(":visible")&&(n=!0),0!==s.find("div.update-item:visible").length||n||(r.length?r.show():((e=h("<div/>",{class:"uc_no_patch_releases text-center"})).html(udclion.updates.no_patch_releases),s.append(e)))),J()}function q(){var e=jQuery("#updates_container div.updraftcentral_table"),t=jQuery("#updates_container div.updraftcentral_table > .tbody"),a=e.find("span.uc_updates_paginator");if(a.length){var s=parseInt(f.item("current_page")),r=parseInt(f.item("items_per_page")),i=f.item("sorted_items")||[],n=parseInt(i.length/r),n=0<parseInt(i.length%r)?n+1:n,d=i.slice((s-1)*r,s*r);if(d.length){jQuery(".row.update-item").hide();for(var o=0;o<d.length;o++){var l=d[o],u=l.data("name"),l=l.data("website_id");jQuery('.row.update-item[data-name="'+u+'"][data-website_id="'+l+'"]').show()}}i=jQuery("<a/>",{id:"load_previous",href:"javascript://"}).html(udclion.updates.previous),r=jQuery("<a/>",{id:"load_next",href:"javascript://"}).html(udclion.updates.next);1<s&&d.length?i.removeClass("disabled"):i.addClass("disabled"),s<n&&d.length?r.removeClass("disabled"):r.addClass("disabled"),a.html(jQuery("<div/>").append(i.clone()).html()+" | "+jQuery("<div/>").append(r.clone()).html()),1<n?a.show():a.hide(),0<jQuery(".row.update-item:visible").length?t.find("div#no_matching_items").remove():0==e.find("div#no_matching_items").length&&(s=jQuery('<div id="no_matching_items" class="row"><div class="col-md-12">'+udclion.updates.no_matching_items+"</div></div>"),t.append(s))}}function P(e,t){var a;return!(void 0===e||!e)&&(a=!1,"compatible"===t&&(h("input#filter_compatible").is(":checked")?T(e)&&(a=!0):T(e)||(a=!0)),!("patch_release"!==t||h("input#filter_patch_release").is(":checked")&&!r(e))||a)}function r(e){if(void 0!==e&&e){var t=e.data("installed_version")||"",a=("number"==typeof t&&(t=t.toString()),e.data("new_version")||"");if("number"==typeof a&&(a=a.toString()),t.length&&a.length){t=t.split("."),a=a.split(".");if(void 0!==t[1]&&void 0!==a[1]&&t[0]+"."+t[1]==a[0]+"."+a[1])return 1}else if("translation"===e.data("entity"))return 1}}function S(){var n=jQuery('#updates_container input[name="uc_updates_filter_keyword"]').val().toLowerCase(),t=(jQuery("#updates_container div.updraftcentral_table"),[]);if(jQuery(".row.update-item").hide(),jQuery("#updates_container .filter-elements input.uc_updates_filter_type:checked").each(function(){var e=jQuery(this);t.push(e.val())}),t.length)for(var e=0;e<t.length;e++)jQuery('.row.update-item[data-entity="'+t[e]+'"]').show();0<n.length&&jQuery(".row.update-item").each(function(){var e,t,a,s,r,i=jQuery(this);void 0!==i&&i.is(":visible")&&(e=i.data("entity")||"",t=i.data("name")||"",a=i.data("website")||"",s=i.data("installed_version")||"",r=i.data("new_version")||"",-1!==e.toLowerCase().indexOf(n)||-1!==t.toLowerCase().indexOf(n)||-1!==a.toLowerCase().indexOf(n)||-1!==s.toString().indexOf(n)||-1!==r.toString().indexOf(n)?i.show():i.hide())});null!==(d=jQuery('#updates_container select[name="uc_updates_sort"]').val().match(/^(.*)_(asc|desc)$/))&&(a=d[1],s=d[2],(o=(d=jQuery("#updates_container div.updraftcentral_table > .tbody")).find(".row.update-item")).sort(function(e,t){e=jQuery(e).data(a).toString().toLowerCase(),t=jQuery(t).data(a).toString().toLowerCase();return"desc"===s?t<e?-1:e<t?1:0:e<t?-1:t<e?1:0}),d.html(o)),jQuery("#updraftcentral_dashboard_existingsites #updates_container");var a,s,r,i,d=jQuery("div.updates_table_container.mass_updates"),o=d.find("div.updraftcentral_table > .tbody"),l=0,u=0,p=0,c=0,_=[];o.find(".row.update-item").each(function(){var e,t=jQuery(this);r=P(t,"compatible"),i=P(t,"patch_release"),t.is(":visible")&&r&&i?("plugin"===(e=t.data("entity"))&&l++,"theme"===e&&u++,"core"===e&&p++,"translation"===e&&c++,_.push(t)):t.hide()}),f.exists("sorted_items")?f.update("sorted_items",_):f.add("sorted_items",_),f.update("current_page",1),q(),d.find(".filter-elements span.filter_plugin_count").html(l),d.find(".filter-elements span.filter_theme_count").html(u),d.find(".filter-elements span.filter_core_count").html(p),d.find(".filter-elements span.filter_translation_count").html(c)}function L(r,e){void 0!==r.site_runner&&(void 0!==e&&r.site_runner.progress.abort(e),r.site_runner.clear_tasks(),f.exists("current_page")?f.update("current_page",1):f.add("current_page",1),f.exists("items_per_page")?f.update("items_per_page",t):f.add("items_per_page",t),h("span.uc_updates_perpage > select").prop("disabled",!1).val(t),n=c=!1,r.container.find("button#btn-reload-updates").removeClass("disabled"),void 0===r.has_non_skipped_items||r.has_non_skipped_items?(r.form_container.find("input, select").prop("disabled",!1),r.container.find('div.updraftcentral_table > .tbody input[name="uc_updates_check_item"]').each(function(){var e=jQuery(this),t=e.data("unavailable");void 0!==t&&t?e.prop("disabled",!0):e.prop("disabled",!1)}),S(),setTimeout(function(){r.site_runner.progress.reset();var e,t,a=jQuery("div.updates_table_container.mass_updates div.updraftcentral_table > .tbody"),s=D();0===s.compatible.total&&0<s.incompatible.total&&(e=a.find("div#no_matching_items"),s='<div class="row text-center no_compatible_items_message"><div class="col-md-12">'+sprintf(udclion.updates.no_compatible_items,s.incompatible.total)+"</div></div>",0===e.length?(t=jQuery('<div id="no_matching_items" class="row"><div class="col-md-12">'+s+"</div></div>"),a.append(t)):e.html(s))},2e3)):(r.container.find("div.updraftcentral_table > .thead").hide(),r.site_runner.progress.reset()))}function A(e,t){var a;0===p.count()?(0<m&&console.log("UpdraftCentral_Updates: process_site_backup - All sites backup has been processed. Proceeding to mass updates now."),t.set_custom_status(udclion.updates.backup_done),setTimeout(function(){e.trigger("click")},2e3)):(a=p.get_items()).length&&((a=a[0]).autobackup_options={caller:A,mass_updates:!0,args:[e,t]},d(a,t))}function i(e,t,a){var s,e=g.item(e),r=!1;return void 0!==e&&e&&(t=UpdraftCentral_Library.md5(e.id+"_"+t),e.update_queue.exists(t))&&void 0!==(s=e.update_queue.item(t))&&s&&l.remove_task(s.key)&&(r=!0,b.remove(t),e.update_queue.remove(t),g.update(e.id,e),p.exists(e.id)&&0==e.update_queue.count()&&p.remove(e.id),void 0!==a)&&a.length&&a.remove(),r}function M(e){var t,a,s,r,i=e.closest(".update-item"),n=i.data("website_id"),n=g.item(n),d=!1;return void 0!==n&&n&&e.is(":visible")&&(t=i.data("entity"),void 0!==(a=i.data("name")))&&a.length&&(s=UpdraftCentral_Library.md5(n.id+"_"+a),n.update_queue.exists(s)||(r=n.get_update_info(t,s))&&(r=l.add_task(k,[r,n]))&&(y.exists(n.id)||y.add(n.id,n),b.add(s,{site_id:n.id,entity:t,name:a,website:i.data("website")}),n.update_queue.add(s,{key:r,site_id:n.id}),g.update(n.id,n),e.prop("checked",d=!0))),d}function z(e,t){var d,a=e.data("site_id"),s=new UpdraftCentral_Site(e),r=(g.exists(a)&&(s=g.item(a)),u.exists(s.id)?((r=u.item(s.id)).clear_tasks(),u.update(s.id,r)):u.add(s.id,new UpdraftCentral_Tasks_Runner),e.find(".updraftcentral_row_extracontents")),e="",i={plugins:null,themes:null,core:null,translations:null},t=(t.data&&(t.data.hasOwnProperty("plugins")&&t.data.plugins.length&&(i.plugins=UpdraftCentral.template_replace("updates-plugin-updates",{plugins:t.data.plugins})),t.data.hasOwnProperty("themes")&&t.data.themes.length&&(i.themes=UpdraftCentral.template_replace("updates-theme-updates",{themes:t.data.themes})),t.data.hasOwnProperty("core")&&t.data.core.length&&(i.core=UpdraftCentral.template_replace("updates-core-updates",{core:t.data.core})),t.data.hasOwnProperty("translations")&&t.data.translations&&(i.translations=UpdraftCentral.template_replace("updates-translation-updates",{translations:t.data.translations.items,as_json:JSON.stringify(t.data.translations.items),website_id:s.id})),t.data.hasOwnProperty("meta"))&&void 0!==t.data.meta.automatic_backups&&(s.automatic_backups=t.data.meta.automatic_backups),!1);i.plugins||i.themes||i.core||i.translations?(e=UpdraftCentral.template_replace("updates-table-header",i),t=!0):e="<h5 class='site_upto_date'>"+udclion.updates.no_updates+"</h5>",r.html('<div class="updraft_updates_output updraft_module_output"><div class="dashicons dashicons-image-rotate updraftcentral_action_show_updates updraftcentral_updates_force_check"></div>'+UpdraftCentral_Library.sanitize_html(e)+"</div>"),r.find("#updates_backup_choice_dropdown").val(udclion.backup_choice).change(),t&&J(),g.exists(a)||g.add(s.id,s),(d=s).updates.plugin.clear(),d.updates.theme.clear(),d.updates.core.clear(),d.updates.translation.clear(),jQuery(".updraftcentral_row_extracontents button.update-go").each(function(){var e=jQuery(this).closest(".row.update-item"),t=e.data("entity"),a=e.data("name"),s=e.data(t+"-info");if("translation"===t||("core"===t||s&&s.hasOwnProperty("update"))&&("core"!==t||s&&s.hasOwnProperty("version"))){var r,e=!0;if(s.hasOwnProperty("installed")&&s.installed.hasOwnProperty("is_mysql")&&!s.installed.is_mysql&&(e=!1),s.hasOwnProperty("sufficient")&&(e=!e||s.sufficient.mysql,r=s.sufficient.php,e?r||(mysql_error="<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php,s.version,s.php_version,s.installed.php)):mysql_error=r?"<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_mysql,s.version,s.mysql_version,s.installed.mysql):"<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php_and_mysql,s.version,s.php_version,s.mysql_version,s.installed.php,s.installed.mysql)),void 0===a||!a||!a.length)switch(t){case"plugin":case"theme":a=s.update[t];break;case"core":a=udclion.updates.wordpress;break;case"translation":a=udclion.updates.translations+" ("+d.site_description+")"}if(void 0!==a&&a&&a.length){var i={},n=!1;switch(t){case"plugin":i.plugin=s.update.plugin,i.slug=s.update.slug,i.label=s.name,i.name=a,i.old_version=s.version,i.new_version=s.update.new_version,i.plugin&&i.plugin.length&&i.slug&&i.slug.length||(n=!0);break;case"theme":i.theme=s.update.theme,i.label=s.name,i.name=a,i.old_version=s.version,i.new_version=s.update.new_version,i.theme&&i.theme.length||(n=!0);break;case"core":"undefined"!=typeof mysql_error&&(i.mysql_error=mysql_error),i.core=s.version,i.label=a,i.name=a,i.old_version=s.installed.version,i.new_version=s.version,i.core&&i.core.length||(n=!0);break;case"translation":i.translation=1,i.label=udclion.updates.translations,i.name=a}!n&&i&&i.hasOwnProperty("name")&&i.name?(e=UpdraftCentral_Library.md5(d.id+"_"+i.name),d.updates[i.entity=t].add(e,i)):0<m&&(console.log("UpdraftCentral: load_site_updates(): update ("+t+") without expected info (details follow)"),console.log(i))}}}),v.load_credentials(d).then(function(e){var t,a=e.request_filesystem_credentials,s=!1;for(t in a)UpdraftCentral_Library.parseBool(a[t])&&(s=!0);d.credentials_required=s,g.update(d.id,d),0<m&&console.log("UpdraftCentral: remote site credentials has been loaded")})}function N(e){var t=h(".updraftcentral_updates_force_check"),a=t.find(".uc-fetch-label");void 0!==a&&a.length&&a.remove(),void 0!==e&&e&&(dayjs.extend(dayjs_plugin_relativeTime),a=udclion.updates.last_fetched+": "+dayjs.unix(e).fromNow(),t.append('<div class="uc-fetch-label">'+a+"</div>"),t.find(".uc-fetch-label").on("click",function(e){e.stopPropagation()}))}function B(e,r){0<m&&console.log("Mass updates execution has been completed!"),h("#updates_dequeue_selected_items > a").trigger("click"),y.clear();for(var t,a,s="<h2>"+udclion.updates.error_items_header+" ("+udclion.updates.skipped+")</h2>",i=[],n=0;n<e.length;n++)void 0!==(a=e[n]).skip&&a.skip&&(void 0!==a.item&&a.item?(t=a.response,i.push({label:t.label,version:t.old_version,site:a.site})):UpdraftCentral.add_dashboard_notice_singleton(s+a.response+" - "+a.site,"error",3e4,{},"errors"));if(i.length){for(n=0;n<i.length;n++){var d=i[n];s+="<div>"+sprintf("%s (%s) - %s.",d.label,d.version,d.site)+"</div>"}UpdraftCentral.add_dashboard_notice_singleton(s,"error",3e4,{},"error_items")}l.progress.set_complete(),l.clear_tasks();var o=g.get_items();if(o.length)for(n=0;n<o.length;n++)o[n].autobackup_requested=!1,o[n].autobackup_complete=!1,g.update(o[n].id,o[n]);U(l),r.find("input, select, button#btn-reload-updates").each(function(){var e=jQuery(this),t=e.data("unavailable");void 0!==t&&t?e.prop("disabled",!0):e.prop("disabled",!1)}),h(".updraftcentral_spinner").is(":visible")&&h(".updraftcentral_spinner").remove(),_=!1,b.clear(),jQuery('#updates_container input[name="uc_updates_check_item"]').prop("checked",!1),setTimeout(function(){l.progress.reset(),S();var e,t,a=r.find("div.updraftcentral_table > .tbody"),s=D();0===s.compatible.total&&0<s.incompatible.total?(e=a.find("div#no_matching_items"),s='<div class="row text-center no_compatible_items_message"><div class="col-md-12">'+sprintf(udclion.updates.no_compatible_items,s.incompatible.total)+"</div></div>",0===e.length?(t=jQuery('<div id="no_matching_items" class="row"><div class="col-md-12">'+s+"</div></div>"),a.append(t)):e.html(s)):a.find("div.updates-update").length<1&&(r.find("div.updraftcentral_table > .thead").hide(),0<a.find("div#no_matching_items").length&&a.find("div#no_matching_items").remove(),a.append('<div class="row"><div class="col-md-12"><h5>'+udclion.updates.no_available_updates+"</h5></div></div>"))},3e3)}function R(e,t){for(var a,s,r=g.item(t.data("site_id")),i=u.item(r.id),n=(0<m&&console.log("Tasks execution has been completed!"),"<h2>"+udclion.updates.error_items_header+" ("+udclion.updates.skipped+")</h2>"),d=[],o=0;o<e.length;o++)void 0!==(s=e[o]).skip&&s.skip&&(void 0!==s.item&&s.item?(a=s.response,d.push({label:a.label,version:a.old_version,site:s.site})):UpdraftCentral.add_dashboard_notice_singleton(n+s.response+" - "+s.site,"error",3e4,{},"errors"));if(d.length){for(o=0;o<d.length;o++){var l=d[o];n+="<div>"+sprintf("%s (%s) - %s.",l.label,l.version,l.site)+"</div>"}UpdraftCentral.add_dashboard_notice_singleton(n,"error",3e4,{},"error_items")}i.progress.set_complete(),r.autobackup_requested=!1,r.autobackup_complete=!1,g.update(r.id,r),Q(r),setTimeout(function(){var e=t.find(".updates_table_container .tbody");e.children().length<1&&(e.closest(".updates_table_container").remove(),t.find(".updraft_updates_output").append("<h5 class='site_upto_date'>"+udclion.updates.no_updates+"</h5>"))},3e3)}function T(e){var t=e.get(0).hasAttribute("data-compatible"),e=e.data("compatible");return!(t&&!e)}function J(){var e,t=D(),a=h("input#filter_compatible").is(":visible")?"mass_updates":"per-site",a=h(".updates_table_container."+a+" .updraftcentral_table > .tbody"),s=a.find("div.no_compatible_items_message");0<t.compatible.total?s.remove():0===t.compatible.total&&0<t.incompatible.total&&(a.find('.row.update-item[data-compatible="false"]:visible').length?s.remove():s.length?0===(e=a.parent(".updraftcentral_table")).find("div#no_matching_items:visible").length&&0===e.find(".uc_no_patch_releases:visible").length?s.show():0<a.find(".row.update-item:visible").length&&s.remove():(e=jQuery('<div class="row text-center no_compatible_items_message"><div class="col-md-12">'+sprintf(udclion.updates.no_compatible_items,t.incompatible.total)+"</div></div>"),a.append(e)))}function D(){var e=h("input#filter_compatible").is(":visible")?"mass_updates":"per-site",e=h(".updates_table_container."+e+" .updraftcentral_table"),t=e.find('.row.update-item[data-entity="translation"]').length,a=e.find('.row.update-item[data-entity="core"]').length,s={compatible:{total:t+a,items:{plugin:0,theme:0,translation:t,core:a}},incompatible:{total:0,items:{plugin:0,theme:0}}};return e.find(".row.update-item[data-compatible]").each(function(){var e=h(this),t=e.data("entity");e.data("compatible")?(s.compatible.total++,s.compatible.items[t]++):(s.incompatible.total++,s.incompatible.items[t]++)}),s}function $(e,t){var a=T(e);t.is(":checked")?a?e.show():e.hide():a?e.hide():e.show()}function E(a){var s=h("input#filter_site_compatible").is(":checked");h(".updraftcentral_table div.update-item").each(function(){var e=h(this),t=T(e);if(!s&&t||s&&!t)return!0;!a.is(":checked")||r(e)?e.show():e.hide()})}UpdraftCentral_Updates.reload_interface=function(){S()},jQuery("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_updates",function(){UpdraftCentral.register_event_handler("click","input#filter_site_compatible",function(){var e,t,a,s,r,i,n=h(this),d=(h(".updraftcentral_table div.update-item").each(function(){var e=h(this);e&&$(e,n)}),d=h("input#filter_compatible"),e=h("input#filter_site_compatible"),t=!1,a=(t=d.is(":visible")?!0:t)?"mass_updates":"per-site",s=(a=h(".updates_table_container."+a+" .updraftcentral_table")).find(".uc_no_patch_releases"),r=a.find(".uc_no_incompatible_items"),i=a.find("div.no_compatible_items_message"),s.length&&s.hide(),r.length&&r.hide(),i.length&&i.hide(),(d.length&&d.is(":visible")&&!d.is(":checked")||e.length&&e.is(":visible")&&!e.is(":checked"))&&(s=!!t&&a.find("div#no_matching_items").length,0!==a.find("div.update-item:visible").length||s||(r.length?r.show():((i=h("<div/>",{class:"uc_no_incompatible_items text-center"})).html(udclion.updates.no_incompatible_items),a.append(i)))),J(),h("input#filter_site_patch_release"));d.is(":checked")&&(E(d),x())}),UpdraftCentral.register_event_handler("click","input#filter_compatible",function(){S()}),UpdraftCentral.register_event_handler("click","input#filter_site_patch_release",function(){E(h(this)),x()}),UpdraftCentral.register_event_handler("click","input#filter_patch_release",function(){S()}),UpdraftCentral.register_event_handler("click",'#updates_container input[name="uc_updates_check_item"]',function(){var e,t=h(this).closest(".update-item"),a=t.data("website_id"),a=g.item(a),s=h(this);s.is(":checked")?e=M(s):void 0!==a&&a&&void 0!==(s=t.data("name"))&&s.length&&(e=i(a.id,s)),void 0!==e&&e&&(U(l),l.tasks_count()?jQuery("#updates_container button#btn-mass-update").removeClass("disabled"):jQuery("#updates_container button#btn-mass-update").addClass("disabled"))}),UpdraftCentral.register_event_handler("click","#updates_queue_selected_items > a",function(){var e=0;jQuery('#updates_container input[name="uc_updates_check_item"]:visible').each(function(){M(h(this))&&e++}),0!==e&&(U(l),l.tasks_count()?jQuery("#updates_container button#btn-mass-update").removeClass("disabled"):jQuery("#updates_container button#btn-mass-update").addClass("disabled"))}),UpdraftCentral.register_event_handler("click","#updates_dequeue_selected_items > a",function(){var a=0;jQuery('#updates_container input[name="uc_updates_check_item"]:checked').each(function(){var e=h(this).closest(".update-item"),t=e.data("website_id"),t=g.item(t);void 0!==t&&t&&h(this).is(":visible")&&void 0!==(e=e.data("name"))&&e.length&&i(t.id,e)&&(a++,h(this).prop("checked",!1))}),0!==a&&(U(l),l.tasks_count()?jQuery("#updates_container button#btn-mass-update").removeClass("disabled"):jQuery("#updates_container button#btn-mass-update").addClass("disabled"))}),UpdraftCentral.register_event_handler("click","#updates_view_queued_items > a",function(){if(b.count()){for(var e=UpdraftCentral_Library.sort(b.get_items(),"name"),t="<ul>",a=0;a<e.length;a++){var s=e[a];t+=sprintf('<li data-site_id="%s" data-name="%s">%s (%s) - %s <button class="btn btn-primary uc_remove_queue_item">%s</button></li>',s.site_id,s.name,s.name,s.entity,s.website,udclion.updates.remove)}t+="</ul>",UpdraftCentral.open_modal(udclion.updates.queued_items,'<div class="uc_queued_items">'+t+"</div>",null,!1,null,!0,"modal-md")}else UpdraftCentral_Library.dialog.alert("<h2>"+udclion.updates.queue_empty+"</h2><p>"+udclion.updates.no_items_in_queue+"</p>")}),UpdraftCentral.register_event_handler("click","#updraftcentral_modal .uc_remove_queue_item",function(){var e=h(this).closest("li"),t=e.parent(),a=e.data("name"),s=e.data("site_id"),s=g.item(s);void 0!==s&&s&&void 0!==a&&a.length&&i(s.id,a,e)&&(void 0!==(e=h('.update-item[data-website_id="'+s.id+'"][data-name="'+a+'"]'))&&e&&e.length&&e.find('input[name="uc_updates_check_item"]').prop("checked",!1),U(l),l.tasks_count()?jQuery("#updates_container button#btn-mass-update").removeClass("disabled"):jQuery("#updates_container button#btn-mass-update").addClass("disabled"),0==t.children().length)&&UpdraftCentral.close_modal()}),UpdraftCentral.register_event_handler("click","#updates_container div.updraftcentral_table span.uc_updates_paginator a#load_previous",function(){var e;jQuery(this).hasClass("disabled")||(e=parseInt(f.item("current_page")),f.update("current_page",e-1),q())}),UpdraftCentral.register_event_handler("click","#updates_container div.updraftcentral_table span.uc_updates_paginator a#load_next",function(){var e;jQuery(this).hasClass("disabled")||(e=parseInt(f.item("current_page")),f.update("current_page",e+1),q())}),UpdraftCentral.register_event_handler("change",'#updates_container select[name="uc_updates_sort"], #updates_container input.uc_updates_filter_type, #updates_container select[name="uc_updates_filter_website"]',function(){S()}),UpdraftCentral.register_event_handler("change","span.uc_updates_perpage > select",function(){var e=h(this).val(),e=e.length?e:t;f.exists("items_per_page")?f.update("items_per_page",e):f.add("items_per_page",e),S()}),UpdraftCentral.register_event_handler("keyup",'#updates_container input[name="uc_updates_filter_keyword"]',function(){S()}),UpdraftCentral.register_event_handler("click","#updates_container button#btn-mass-update",function(){if(!jQuery(this).hasClass("disabled")||0===p.count()&&l.tasks_count()&&!c){var e=jQuery(this),a=jQuery("div.updates_table_container.mass_updates"),t=(0<m&&console.log("Mass updates execution started..."),!a||h(".updraftcentral_spinner").is(":visible")||h(a).prepend('<div class="updraftcentral_spinner"></div>'),U(l,_=!0),jQuery("div.updates_table_container.mass_updates").find("input, select, button#btn-reload-updates").attr("disabled",!0),a.find("div.progress-section div.udc-progress-bar"));if(l.progress.set_container(t),o.backup_choice=h(".updates_table_container.mass_updates select#updates_backup_choice_dropdown").val(),p.clear(),-1!=h.inArray(o.backup_choice,["default","yes"])&&0<y.count()){var s=y.get_items();if(s.length)for(var r=0;r<s.length;r++){var i,n,d=s[r];!d.autobackup_complete&&0<d.update_queue.count()&&(i=!!("yes"==o.backup_choice||d.automatic_backups&&"default"==o.backup_choice),n="site"+d.id,!i||p.exists(d.id)||UpdraftCentral.backup_disabled.exists(n)||p.add(d.id,d))}}0<p.count()?A(e,l.progress):l.process_tasks().then(function(t){udclion.backup_choice!=o.backup_choice?UpdraftCentral.save_settings({backup_choice:o.backup_choice},a).then(function(e){udclion.backup_choice=o.backup_choice,B(t,a)}):B(t,a)}).fail(function(e){0<m&&(console.log("Mass updates execution has stopped due to the following error(s):"),console.log(e)),h("#updates_dequeue_selected_items > a").trigger("click"),y.clear(),l.progress.abort(udclion.updates.process_aborted),l.clear_tasks(),U(l),jQuery("div.updates_table_container.mass_updates").find("input, select, button#btn-reload-updates").each(function(){var e=jQuery(this),t=e.data("unavailable");void 0!==t&&t?e.prop("disabled",!0):e.prop("disabled",!1)}),_=!1,b.clear(),jQuery('#updates_container input[name="uc_updates_check_item"]').prop("checked",!1),S(),setTimeout(function(){l.progress.reset()},2e3)})}}),UpdraftCentral.register_event_handler("click","#updates_container #btn-reload-updates",function(){jQuery(this).hasClass("disabled")||(n=!0,jQuery(document).find("button.updraftcentral_action_show_all_updates").trigger("click"))}),UpdraftCentral.register_event_handler("click",".updraftcentral_row_extracontents button.update-info",function(){var e=jQuery(this).closest(".row.update-item"),t=e.data("entity");UpdraftCentral.display_item_info(e,t,null,null,"updates")}),UpdraftCentral.register_event_handler("click","#updraftcentral_updraftplus_actions > button.updraftcentral_action_choose_another_site",function(){h(this).html(a),h(this).siblings(".updraftcentral_action_show_all_updates").show()}),UpdraftCentral.register_event_handler("click","#updraftcentral_updraftplus_actions > button.updraftcentral_action_show_all_updates",function(){h(this).hide();var e=h(this).siblings(".updraftcentral_action_choose_another_site"),e=(void 0===a&&(a=e.text().replace(/\s\s+/,"")),e.html(udclion.return_to_updates),jQuery("#updraftcentral_sites_search_area, #updraftcentral_dashboard_existingsites .updraftcentral_site_row, #updraftcentral_dashboard_existingsites .updraftcentral_row_divider").hide(),jQuery("#updraftcentral_dashboard_existingsites")),i=e.find("#updates_container"),t=(0===i.length&&(i=jQuery("<div/>",{id:"updates_container",class:"updraftcentral_row_extracontents"}),e.append(i)),UpdraftCentral.template_replace("updates-table-mass-header",{})),r=(i.html('<div class="updraft_updates_output updraft_module_output">'+t+"</div>"),i.find("#updates_backup_choice_dropdown").val(udclion.backup_choice).change(),b.clear(),y.clear(),0<g.count()&&h.map(g.get_items(),function(e,t){e.update_queue.clear()}),f.clear(),l.clear_tasks(),e.find(".updraftcentral_site_row:not(.suspended)").each(function(){var e,t,a,s,r=jQuery(this);e=r,void 0!==(s=h("#updraftcentral-search-info").data("filters"))&&0!==s.trim().length&&(t=s.split(","),s=e.find(".udc_tag_text"),a=!1,s.each(function(){var e=h(this).data("tag_name");if(-1!==t.indexOf(e))return!(a=!0)}),!a)||l.add_task(V,[r,i])}),i.find("button#btn-reload-updates").addClass("disabled"),i.find("div.updates_table_container.mass_updates"));r.find("input, select").attr("disabled",!0),c=!0,h("span.uc_updates_perpage > select").prop("disabled",!0),l.progress.set_container(r.find("div.progress-section div.udc-progress-bar")),l.tasks_count()&&!h(".updraftcentral_spinner").is(":visible")&&r.prepend('<div class="updraftcentral_spinner"></div>'),setTimeout(function(){l.process_tasks().then(function(e){r.find(".updraftcentral_spinner").remove(),0<m&&console.log("Tasks execution has been completed!");for(var t,a=!1,s=0;s<e.length;s++)void 0===(t=e[s]).skip||t.skip?0<m&&void 0!==t.site&&(console.log(t.site+" has been skipped due to the following reason or error:"),console.log(t)):a=!0;a||(i.find("div.updraftcentral_table").is(":visible")||i.find("div.updraftcentral_table").show(),i.find("div.updraftcentral_table > .tbody").append('<div class="row"><div class="col-md-12"><h5>'+udclion.updates.no_available_updates+"</h5></div></div>")),l.progress.set_complete(udclion.updates.loading_process_completed),L({site_runner:l,container:i,form_container:r,has_non_skipped_items:a})}).fail(function(e){0<m&&(console.log("Tasks execution has stopped due to the following error(s):"),console.log(e)),L({site_runner:l,container:i,form_container:r},udclion.updates.abort)})},1e3)}),UpdraftCentral.register_modal_listener("ul#updates-sections-list a.updates-section-link",function(e){e.preventDefault();e=jQuery(this).data("section");jQuery("#updraftcentral_modal #updates-sections-list li.selected").removeClass("selected"),jQuery(this).closest("li").addClass("selected"),jQuery("#updraftcentral_modal .updates-section").hide(),jQuery("#updraftcentral_modal #updates-section-"+e).show()}),UpdraftCentral.register_modal_listener(".request-filesystem-credentials-dialog-content #ssh",function(){jQuery("#updraftcentral_modal .request-filesystem-credentials-dialog-content #ssh_keys").show()}),UpdraftCentral.register_modal_listener(".request-filesystem-credentials-dialog-content #ftp, .request-filesystem-credentials-dialog-content #ftps",function(){jQuery("#updraftcentral_modal .request-filesystem-credentials-dialog-content #ssh_keys").hide()}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents button#btn-update-all",function(a){var e,t,s,r=g.item(a.data("site_id")),i=u.item(r.id);(!jQuery(this).hasClass("disabled")||r.autobackup_complete&&!r.update_processing&&i.tasks_count())&&(e=jQuery(this),s=jQuery(this).parent(),0<m&&console.log("Task runner execution started..."),j(i,!0),jQuery(".updraftcentral_row_extracontents button.update-go").addClass("disabled"),jQuery(".updraftcentral_row_extracontents button.update-in-progress").addClass("disabled"),0===(t=s.find("div.progress-section div.udc-progress-bar")).length&&(t=s.append('<div class="row progress-section"><div class="col-md-12 udc-progress-bar"></div></div>').find("div.progress-section div.udc-progress-bar")),i.progress.set_container(t),o.backup_choice=h(".updates_table_container.per-site select#updates_backup_choice_dropdown").val(),s="site"+r.id,t=!1,(t=UpdraftCentral.backup_disabled.exists(s)&&(r.automatic_backups&&"default"==o.backup_choice||"yes"==o.backup_choice)?!0:t)||!(r.automatic_backups&&"default"==o.backup_choice||"yes"==o.backup_choice)||r.autobackup_complete?(t&&r.autobackup_options.hasOwnProperty("bypass")&&r.autobackup_options.bypass&&UpdraftCentral.add_dashboard_notice(sprintf(udclion.backup_disabled,a.data("site_description"))),s=0,r.autobackup_complete&&r.autobackup_options.hasOwnProperty("bypass")&&!r.autobackup_options.bypass&&(i.progress.set_custom_status(udclion.updates.backup_done),r.autobackup_options.bypass=!0,s=2e3),setTimeout(function(){r.update_processing=!0,g.update(r.id,r),i.process_tasks().then(function(t){udclion.backup_choice!=o.backup_choice?UpdraftCentral.save_settings({backup_choice:o.backup_choice},a).then(function(e){udclion.backup_choice=o.backup_choice,R(t,a)}):R(t,a)}).fail(function(e){0<m&&(console.log("Tasks execution has stopped due to the following error(s):"),console.log(e)),Q(r,udclion.updates.process_aborted)})},s)):(r.autobackup_options={caller:e,bypass:!1},d(r,i.progress)))}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents button.update-go",function(e){if(!jQuery(this).hasClass("disabled")){var t,a,s,r=g.item(e.data("site_id")),e=u.item(r.id),i=jQuery(this).closest(".row.update-item"),n=i.data("entity");if(void 0===(d=i.data("name")))switch(n){case"plugin":case"theme":var d=i.data(n+"-info").update[n];break;case"core":d=udclion.updates.wordpress;break;case"translation":d=udclion.updates.translations+" ("+r.site_description+")"}void 0!==r&&void 0!==d&&d.length&&(t=UpdraftCentral_Library.md5(r.id+"_"+d),a=r.get_update_info(n,t))&&(void 0!==a.mysql_error?UpdraftCentral_Library.dialog.alert(a.mysql_error,null,!1):(s=e.add_task(k,[a,r]))&&(u.update(r.id,e),0<m&&(console.log("Item queued for processing:"),console.log(a)),i.find("button.update-go").hide(),i.find(".update-in-progress").css("width","auto").show(),f.add(t,s),j(e)))}}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents button.update-in-progress",function(e){if(!jQuery(this).hasClass("disabled")){var t,a,s=g.item(e.data("site_id")),e=u.item(s.id),r=jQuery(this).closest(".row.update-item"),i=r.data("entity");if(void 0===(n=r.data("name")))switch(i){case"plugin":case"theme":var n=r.data(i+"-info").update[i];break;case"core":n=udclion.updates.wordpress;break;case"translation":n=udclion.updates.translations+" ("+s.site_description+")"}void 0!==s&&void 0!==n&&n.length&&(t=UpdraftCentral_Library.md5(s.id+"_"+n),f.exists(t))&&(a=f.item(t),e.remove_task(a))&&(r.find("button.update-in-progress").hide(),r.find(".update-go").css("width","auto").show(),f.remove(t),j(e))}}),UpdraftCentral.register_row_clicker(".updraftcentral_action_show_updates",function(s){var e=UpdraftCentral.get_cached_response(s.data("site_id"),"updates.get_updates");null!==e&&!jQuery(this).hasClass("updraftcentral_updates_force_check")&&UpdraftCentral.is_data_good_to_use(e.created)?(z(s,e.reply),N(e.created)):(e={force_refresh:!1},jQuery(this).hasClass("updraftcentral_updates_force_check")&&(e.force_refresh=!0),N(),UpdraftCentral.send_site_rpc("updates.get_updates",e,s,function(t,e,a){"ok"==e&&t&&"updates"==UpdraftCentral.get_dashboard_mode()&&UpdraftCentral.cache_response(s.data("site_id"),"updates.get_updates",{force_refresh:!1},t).then(function(e){z(s,t),N(dayjs().unix()),UpdraftCentral.refresh_available_updates_display(s.data("site_id"))})}))},!0),jQuery("#updraftcentral_notice_container").on("click",".updraftcentral_notice .update-failure-messages-show",function(e){e.preventDefault(),jQuery(this).hide().siblings(".update-failure-messages-text").slideDown()}),jQuery("#updraftcentral_notice_container").on("click",".updraftcentral_notice > .updraftcentral_notice_dismiss",function(){var e;1<jQuery(this).closest("#updraftcentral_notice_container").find(".update-errors").html().trim().length&&(e=$site_row.data("site_id"),(e=g.item(e)).update_processing=!1,g.update(e.id,e))}),jQuery("#updraftcentral_dashboard_existingsites").on("updraftcentral_listener_finished_updraftplus_backup",function(e,t){e.preventDefault();var e=t.site_id,t=g.item(e);void 0===t||t.autobackup_complete||(0<m&&console.log("UpdraftCentral: automatic backup is complete."),t.autobackup_complete=!0,g.update(t.id,t),void 0!==t.autobackup_options.caller&&(e=t.autobackup_options.caller,void 0!==t.autobackup_options.mass_updates&&t.autobackup_options.mass_updates?(p.exists(t.id)&&p.remove(t.id),e.apply(null,t.autobackup_options.args)):e.trigger("click")))}),jQuery("#updraftcentral_dashboard_existingsites_container").on("click",".updraftcentral_site_row "+e+" .updates-update a",function(e){var t=jQuery(this).attr("href");void 0!==t&&"http"==t.substring(0,4)&&(e.preventDefault(),window.open(t,"_blank").focus())})})}jQuery(function(){new UpdraftCentral_Updates});